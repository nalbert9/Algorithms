import msal
import requests

# Constants
TENANT_ID = 'your-tenant-id'
CLIENT_ID = 'your-client-id'
CLIENT_SECRET = 'your-client-secret'
AUTHORITY = f'https://login.microsoftonline.com/{TENANT_ID}'
SITE_ID = 'your-site-id'
FOLDER_PATH = 'folder-relative-path'  # E.g., 'Documents/folder'

# Create a confidential client
app = msal.ConfidentialClientApplication(
    CLIENT_ID, authority=AUTHORITY, client_credential=CLIENT_SECRET
)

# Get a token
scopes = ['https://graph.microsoft.com/.default']
token_response = app.acquire_token_for_client(scopes)
access_token = token_response.get('access_token')

# Call the Graph API
if access_token:
    endpoint = f'https://graph.microsoft.com/v1.0/sites/{SITE_ID}/drive/root:/{FOLDER_PATH}:/children'
    headers = {
        'Authorization': f'Bearer {access_token}',
        'Content-Type': 'application/json'
    }
    response = requests.get(endpoint, headers=headers)
    if response.status_code == 200:
        print("Folder contents:", response.json())
    else:
        print("Failed to retrieve folder contents:", response.json())
else:
    print("Failed to get access token:", token_response.get('error_description'))